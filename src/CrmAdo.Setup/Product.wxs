<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
  <Product Id="*" Name="CrmAdo ADO.NET Data Provider" Language="1033" Version="!(bind.FileVersion.CrmAdo.dll)" Manufacturer="CrmAdo" UpgradeCode="0dcf7b53-5dca-439c-b3a7-adf70da4ac5f">
    <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />
    <UIRef Id="WixUI_Mondo" />
    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    <MediaTemplate EmbedCab="yes" />
    <WixVariable Id="WixUILicenseRtf" Value="Eula.rtf" />
    <Feature Id="ProductFeature" Title="CrmAdo ADO.NET Data Provider" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
    </Feature>
    <Binary Id="CustomActionsDll" src="$(var.CrmAdo.Installation.TargetDir)$(var.CrmAdo.Installation.TargetName).CA.dll" />
    <!--<CustomAction Id='AssignConfigFile'
               Property='CRMADO_'
               Value='[PRODUCTINSTALLFOLDER]pathtoconfigfile\web.config' />-->
    <CustomAction Id='ConfigureCrmAdoDataProvider' BinaryKey='CustomActionsDll' DllEntry='ConfigureCrmAdoDataProvider' Execute='immediate' Return='check'/>
    <CustomAction Id='RemoveCrmAdoDataProviderConfiguration' BinaryKey='CustomActionsDll' DllEntry='RemoveCrmAdoDataProviderConfiguration' Execute='immediate' Return='check'/>
    <InstallExecuteSequence>
      <Custom Action='ConfigureCrmAdoDataProvider' After='InstallFiles'>
        NOT Installed
      </Custom>
      <Custom Action='RemoveCrmAdoDataProviderConfiguration' Before='InstallFinalize'>
        Installed AND NOT UPGRADINGPRODUCTCODE
      </Custom>
    </InstallExecuteSequence>    
  </Product>
  <!--$(var.CrmAdo.Installation.TargetDir)$(var.CrmAdo.Installation.TargetName).CA.dll-->
  <!-- Step 1: Define the directory structure -->
  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <!--<Directory Id="INSTALLFOLDER" Name="CrmAdo.Setup" />-->
        <Directory Id="ProductDirectory" Name="CrmAdo">
          <Directory Id="GAC" Name="GAC">
          </Directory>
        </Directory>
      </Directory>
    </Directory>

  </Fragment>

  <Fragment>
    <ComponentGroup Id="ProductComponents">
      <!-- TODO: Remove the comments around this Component element and the ComponentRef below in order to add resources to this installer. -->
      <!--<Component Id="CrmAdo.Installation.CA.dll" Directory="TARGETDIR" Guid="954DEBCF-D06C-4638-887B-8356AC992091">
        --><!-- Add to GAC. --><!--
        <File Id="CrmAdo.Installation.CA.dll"
            Source="$(var.CrmAdo.Installation.TargetDir)$(var.CrmAdo.Installation.TargetName).CA.dll"
            Assembly="no"
            KeyPath="yes" />
      </Component>-->
      
      <Component Id="CrmAdo.dll" Directory="GAC" Guid="D97A86CC-C9E4-47B7-BF04-2DEC44B16E84">
        <!-- Add to GAC. -->
        <File Id="CrmAdo.dll"
            Source="$(var.CrmAdo.TargetDir)$(var.CrmAdo.TargetFileName)"
            Assembly=".net"
            KeyPath="yes" />
      </Component>

      <Component Id="Microsoft.Xrm.Sdk.dll" Directory="GAC" Guid="A666F417-90E8-4EC6-9187-3C1B3CB4CA57">
        <!-- Add to GAC. -->
        <File Id="Microsoft.Xrm.Sdk.dll"
            Source="$(var.CrmAdo.TargetDir)Microsoft.Xrm.Sdk.dll"
            Assembly=".net"
            KeyPath="yes" />
      </Component>

      <Component Id="SQLGeneration.dll" Directory="GAC" Guid="E855ADC7-1F30-4CFF-A143-5BA3CCFC100F">
        <!-- Add to GAC. -->
        <File Id="SQLGeneration.dll"
            Source="$(var.CrmAdo.TargetDir)SQLGeneration.dll"
            Assembly=".net"
            KeyPath="yes" />
      </Component>

    </ComponentGroup>
  </Fragment>


</Wix>