<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>CrmAdo by dazinator</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>CrmAdo</h1>
        <h2>Bringing ADO.Net to Dynamics Crm.</h2>
        <a href="https://github.com/dazinator/CrmAdo" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h3>
<a name="huh" class="anchor" href="#huh"><span class="octicon octicon-link"></span></a>Huh?</h3>

<p>So you want to write some code that interacts with some data / entities in Dynamics CRM? You need to retrieve contacts, linked to addresses, linked to some custom entity you say? Where the firstname is "Joe" you say? </p>

<p>So you reference the Dynamics SDK libraries, and you read through the documentation, and you start delving into the world of writing "QueryExpressions" and "FetchXml", and using an "OrganisationService", and building "FilterExpressions" and adding "Conditions" and getting "AliasedValues". </p>

<p>Take a step back. Your code is now completely coupled to the Dynamics CRM SDK. Not only that, you have had to learn all sorts of SDK specific stuff to perform a simple query against a datasource. What happened to that wonderfully expressive query language that we allready have i.e SQL? What happened to the .NET standard way to interact with datasources i.e ADO.Net?</p>

<p>CrmAdo is an ADO.Net data provider for Dynamics Crm that uses SQL as its query language. It's goal is to hide completely the Dynamics SDK from you, and to expose Dynamics Crm as if it were an ordinary SQL datasource, via the standard ADO.Net classes.</p>

<p>It allows you to use the familiar SQL language to write your queries, just like you would against other ADO.Net data sources. CrmAdo will translate your SQL commands into the appropriate IOrganisation web service calls and interactions behind the scenes. </p>

 <h3>
<a name="Getting Started" class="anchor" href="#Getting Started"><span class="octicon octicon-link"></span></a>Getting Started</h3>

<p>Add the <a href="https://www.nuget.org/packages/CrmAdo/">CrmAdo NuGet package</a> to your visual studio project. This will also install the Dynamics SDK libraries and all other dependencies. </p>

<p>A connection string will automatically be added to your web / app config file when you install the NuGet package, you should set this connection string appropriately for the dynamics crm organisation that you want to connect to.</p>

<p>You can now use ADO.net to connect to and query CRM. Here is some quick sample code:</p>
<pre><code>

            var dbprovider = DbProviderFactories.GetFactory(CrmDbProviderFactory.Invariant);
            var connectionString = ConfigurationManager.ConnectionStrings["CrmOrganisation"];
            using (var conn = dbprovider.CreateConnection())
            {
                conn.ConnectionString = connectionString.ConnectionString;
                conn.Open();
                var command = conn.CreateCommand();
                command.CommandText = "Select C.contactid, C.firstname, C.lastname, A.line1 From contact C LEFT JOIN customeraddress A on C.contactid = A.parentid";
              
                using (var reader = command.ExecuteReader())
                {
                    int resultCount = 0;
                    foreach (var result in reader)
                    {
                        resultCount++;
                        var contactId = (Guid)reader["contactid"];
                        var firstName = (string)reader["firstname"];
                        var lastName = reader.GetString(2);
                        Console.WriteLine("{0} {1} {2}", contactId, firstName, lastName);
                    }
                    Console.WriteLine("There were " + resultCount + " results..");
                }
            }

        }
  
</code></pre>

<p>Note: the above query doesn't use parameters, however parameters are fully supported.</p>
 <h3>Supported SQL - some examples</h3>
 <p>The Dynamics CRM SDK does impose some limitations as to the T-SQL that can be used. Therefore, the following aims to give a quick overview of the T-SQL that can be used - although it is not an exhaustive list.
  </p>
   <h4>Joins </h4>
   <p>You can use Inner Joins, and Left Joins. Full outer joins are not supported. Nesting joins is fully supported.</p>
   <pre><code>
   Select C.contactid, C.firstname, C.lastname, A.line1 From contact C INNER JOIN customeraddress A on C.contactid = A.parentid
   </code></pre>
   <h4>Filter operators </h4>
   <p>You can use any of the following filter operators in your where clause:</p>
   <ul>
    <li>=</li>
    <li>&lt;&gt;</li>
    <li>&gt;=</li>
    <li>&lt;=</li>
    <li>&gt;</li>
    <li>&lt;</li>
    <li>IS NULL</li>
    <li>IS NOT NULL</li>
    <li>LIKE</li>
    <li>NOT LIKE</li>
    <li>IN</li>
    <li>NOT IN</li>
    <li>CONTAINS</li>
    <li>NOT CONTAINS</li>
   </ul>
   <pre><code>
   Select C.contactid, C.firstname, C.lastname, A.line1 From contact C INNER JOIN customeraddress A on C.contactid = A.parentid WHERE A.line1 LIKE '%deathstar%'
   </code></pre>
   
  <h4>Filter operators with Conjunctions </h4>
   <p>You can use conjunctions with filter operators to combine them together logically:</p>
   <ul>
    <li>AND</li>
    <li>OR</li>
   </ul>
   <pre><code>
   Select C.contactid, C.firstname, C.lastname, A.line1 From contact C INNER JOIN customeraddress A on C.contactid = A.parentid WHERE A.line1 LIKE '%deathstar%' AND C.firstname = 'Darth'
   </code></pre>
   <p>More complex:</p>
   <h4>Filter operators with Conjunctions and Parenthesis </h4>
   <p>You can use multiple filters, with AND and OR conjunctions as well as parenthesis.:</p>
   <ul>
    <li>AND</li>
    <li>OR</li>
   </ul>
   <pre><code>
   Select C.contactid, C.firstname, C.lastname, A.line1 From contact C INNER JOIN customeraddress A on C.contactid = A.parentid WHERE (((A.line1 LIKE '%deathstar%' AND C.firstname = 'Darth') OR (A.line1 LIKE '%away mission%')) AND C.lastname ='Vader')
   </code></pre>
   
<h3>DDL</h3>
<p>
   I am currently busy adding support for DDL statements. This will let you create / alter / drop entities / attributes in Dynamics CRM via standard SQL commands.
</p>
<h4>Create Entity</h4>
  <pre><code>
   CREATE TABLE MyEntity(MyEntityId UNIQUEIDENTIFIER PRIMARY KEY, MyEntityPrimaryName VARCHAR(500))
   </code></pre>
 
 <h4>Acknowledgements</h4>
 <p>
   Much thanks and appreciation goes to <a href="https://github.com/jehugaleahsa">Travis Parks (@jehugaleahsa)</a> for his work with the SQLGeneration library which is used under the hood by CrmAdo to carry out the complex task of parsing T-SQL. Travis has done a wonderful job with the SQLGeneration library, and this has saved me a tonne of work :D
 </p>


        <aside id="sidebar">
          <a href="https://github.com/dazinator/CrmAdo/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/dazinator/CrmAdo/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/dazinator/CrmAdo"></a> is maintained by <a href="https://github.com/dazinator">dazinator</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-49278315-1");
            pageTracker._trackPageview();
            setTimeout(function(){
              var pageTracker = _gat._getTracker("UA-49278315-1");
              pageTracker._trackEvent('bouncethreshold', 'thresholdreached', 'seconds', 20)
              },20000);
            } catch(err) {}
          </script>

  </body>
</html>
